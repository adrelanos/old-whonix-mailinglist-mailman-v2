<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>

<!-- Mirrored from www.whonix.org/pipermail/whonix-devel/2015-February/000311.html by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Wed, 29 Apr 2020 08:55:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=us-ascii" /><!-- /Added by HTTrack -->
<HEAD>
<TITLE> [Whonix-devel] [qubes-devel] Re: Exposing AnonVM Users with Dom0 Hardware Fingerprint Leaks
</TITLE>
<script>window.mod_pagespeed_start = Number(new Date());</script><LINK REL=Index HREF=index.html>
<LINK REL=made HREF="mailto:whonix-devel%40whonix.org?Subject=Re%3A%20%5BWhonix-devel%5D%20%5Bqubes-devel%5D%20Re%3A%20Exposing%20AnonVM%20Users%20with%0A%20Dom0%20Hardware%20Fingerprint%20Leaks&In-Reply-To=%3C036a0f7f17fcc6ef3789c6013e683f25%40riseup.net%3E">
<META NAME=robots CONTENT="index,nofollow">
<style type="text/css">pre{white-space:pre-wrap}</style>
<META http-equiv=Content-Type content="text/html; charset=us-ascii">
<LINK REL=Previous HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000310.html>
<LINK REL=Next HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000312.html>
</HEAD>
<BODY BGCOLOR="#ffffff">
<H1>[Whonix-devel] [qubes-devel] Re: Exposing AnonVM Users with Dom0 Hardware Fingerprint Leaks</H1>
<B>WhonixQubes</B>
<A HREF="mailto:whonix-devel%40whonix.org?Subject=Re%3A%20%5BWhonix-devel%5D%20%5Bqubes-devel%5D%20Re%3A%20Exposing%20AnonVM%20Users%20with%0A%20Dom0%20Hardware%20Fingerprint%20Leaks&In-Reply-To=%3C036a0f7f17fcc6ef3789c6013e683f25%40riseup.net%3E" TITLE="[Whonix-devel] [qubes-devel] Re: Exposing AnonVM Users with Dom0 Hardware Fingerprint Leaks">whonixqubes at riseup.net
</A><BR>
<I>Wed Feb 18 20:54:02 CET 2015</I>
<P><UL>
<LI>Previous message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000310.html>[Whonix-devel] [qubes-devel] Re: Exposing AnonVM Users with Dom0 Hardware Fingerprint Leaks
</A></LI>
<LI>Next message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000312.html>[Whonix-devel] [qubes-devel] Re: Exposing AnonVM Users with Dom0 Hardware Fingerprint Leaks
</A></LI>
<LI> <B>Messages sorted by:</B>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/date.html#311">[ date ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/thread.html#311">[ thread ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/subject.html#311">[ subject ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/author.html#311">[ author ]</a>
</LI>
</UL>
<HR>
<PRE>On 2015-02-18 8:40 am, Radoslaw Szkodzinski wrote:
&gt;<i> On Tue, Feb 17, 2015 at 11:55 AM, WhonixQubes &lt;<A HREF="../../../../external.html?link=https://www.whonix.org/cgi-bin/mailman/listinfo/whonix-devel">whonixqubes at riseup.net</A>&gt; 
</i>&gt;<i> wrote:
</i>&gt;&gt;<i> Right.
</i>&gt;&gt;<i> 
</i>&gt;&gt;<i> For example, subdividing the cross-section of privacy/anonymity users 
</i>&gt;&gt;<i> by the
</i>&gt;&gt;<i> following attributes would no doubt be a privacy/anonymity killer for
</i>&gt;&gt;<i> individual human identities...
</i>&gt;&gt;<i> 
</i>&gt;&gt;<i> # of unique combined mixtures of the following attributes:
</i>&gt;&gt;<i> - # of Qubes Users
</i>&gt;<i> 
</i>&gt;<i> This is relatively easy, because all Qubes users would look similarly
</i>&gt;<i> thanks to the local IP address.
</i>&gt;<i> Contingent on being able to retrieve local IP or MAC address - which
</i>&gt;<i> is not trivial in a privacy-minded setup.
</i>&gt;<i> Other information looks like a Fedora system with hardware not
</i>&gt;<i> supporting OpenGL.
</i>&gt;<i> 
</i>&gt;&gt;<i> - # of Qubes + Tor AnonVM Users
</i>&gt;<i> 
</i>&gt;<i> This would require correlating previous step with the list of Tor exit
</i>&gt;<i> nodes or using a hidden service for a callback.
</i>&gt;<i> 
</i>&gt;&gt;<i> - # of Qubes + Whonix AnonVM Users
</i>&gt;<i> 
</i>&gt;<i> This is actually much harder, there's not enough information to
</i>&gt;<i> discern between Tor AnonVM and Whonix AnonVM I think.
</i>&gt;<i> 
</i>&gt;&gt;<i> - # of CPU Model Info
</i>&gt;&gt;<i> - # of CPU Microcode Version
</i>&gt;<i> 
</i>&gt;<i> This information is hard to get, unless you crack every one of the
</i>&gt;<i> people above - and then, you have to be sure they do not use the same
</i>&gt;<i> CPU model.
</i>&gt;<i> To do so, you need to break Tor or, say, JavaScript implementation of
</i>&gt;<i> most browsers. Then at least access /proc/cpuinfo.
</i>&gt;<i> Alternatively, run a plugin which allows access to such information.
</i>&gt;<i> (Java comes to mind.)
</i>&gt;<i> 
</i>&gt;<i> Fortunately, CPUID does not provide Processor Serial Number in any 
</i>&gt;<i> recent CPU.
</i>&gt;<i> 
</i>&gt;<i> Microcode can be either updated when starting Xen via
</i>&gt;<i> ucode=&lt;number|scan&gt; and the microcode image in number case or
</i>&gt;<i> initramfs with early microcode in scan case.
</i>&gt;<i> If Qubes updated the microcode for everyone (a generally good idea),
</i>&gt;<i> that could be ignored. Xen 4.4 supports it, so it could be done for
</i>&gt;<i> r3.
</i>&gt;<i> I think dracut supports adding microcode to the initramfs, so would
</i>&gt;<i> just have to add the parameter.
</i>&gt;<i> 
</i>&gt;&gt;<i> ...should be pretty easy to reveal individual people through their 
</i>&gt;&gt;<i> usage of
</i>&gt;&gt;<i> Qubes privacy/anonymity this way.
</i>&gt;<i> 
</i>&gt;<i> No. Again, the hardest step is the last one - breaking out of the
</i>&gt;<i> sandbox of the web browser.
</i>&gt;<i> Once you have local access, there is enough ways to fingerprint
</i>&gt;<i> everything imaginable that you've lost.
</i>&gt;<i> 
</i>&gt;&gt;<i> Although, AFAIK, other platforms are not totally immune from this. 
</i>&gt;&gt;<i> Some just
</i>&gt;&gt;<i> have a higher # of total users out in the world, but at their 
</i>&gt;&gt;<i> technical
</i>&gt;&gt;<i> expense of lacking strong security isolation to protect the integrity 
</i>&gt;&gt;<i> of
</i>&gt;&gt;<i> their privacy/anonymity systems.
</i>&gt;<i> 
</i>&gt;<i> Disable JavaScript, plugins, OpenGL. (e.g. NoScript) Disable cookies.
</i>&gt;<i> You are then depending on the web browser's security of this mechanism
</i>&gt;<i> and should be left with a vastly smaller TCB.
</i>&gt;<i> It also becomes much harder to identify you as a Qubes user as well.
</i>&gt;<i> 
</i>&gt;&gt;&gt;<i> Thus, perhaps we should consider distributing Whonix workstation
</i>&gt;&gt;&gt;<i> template as an HVM template instead of a PVM one? Fortunately we do 
</i>&gt;&gt;&gt;<i> have
</i>&gt;&gt;&gt;<i> templates support for HVMs, so this should be perfectly possible.
</i>&gt;&gt;<i> 
</i>&gt;&gt;<i> 
</i>&gt;&gt;<i> 
</i>&gt;&gt;<i> Assuming there is no feasible way to accomplish this objective with 
</i>&gt;&gt;<i> PVMs,
</i>&gt;&gt;<i> then implementing the Whonix-Workstation in a HVM template with
</i>&gt;&gt;<i> &quot;generic_cpuid&quot; sounds like the right move.
</i>&gt;<i> 
</i>&gt;<i> Available free memory in the VM is a much better predictor of the user
</i>&gt;<i> and usage than CPUID.
</i>&gt;<i> Especially if you allow the VM to balloon (automatically resize 
</i>&gt;<i> memory).
</i>&gt;<i> This information is even available from JS in Chrome. (but not Firefox
</i>&gt;<i> to my knowledge)
</i>&gt;<i> 
</i>&gt;&gt;<i> Another anonymity upshot of HVMs is their, by default, non-seamless 
</i>&gt;&gt;<i> fixed
</i>&gt;&gt;<i> single windowing. Even though the seamless desktop mode of the new 
</i>&gt;&gt;<i> Qubes +
</i>&gt;&gt;<i> Whonix platform is sexy and smooth to use, it does expose another
</i>&gt;&gt;<i> semi-unique host machine attribute to the AnonVMs, which is the host's
</i>&gt;&gt;<i> unique display resolution size and pixel depth (maybe some other 
</i>&gt;&gt;<i> related
</i>&gt;&gt;<i> stuff too?). Not as bad of an attribute as the host's unique CPU info,
</i>&gt;<i> 
</i>&gt;<i> CPUID does not have unique CPU info - Processor Serial Number is not
</i>&gt;<i> implemented there in modern CPUs.
</i>&gt;<i> 
</i>&gt;&gt;<i> but
</i>&gt;&gt;<i> still would be best to make use of the fixed single windowing for 
</i>&gt;&gt;<i> AnonVMs so
</i>&gt;&gt;<i> this could be generic. Maybe both seamless and non-seamless windowing
</i>&gt;&gt;<i> options could be offered for Whonix-Workstation HVM template, since 
</i>&gt;&gt;<i> some
</i>&gt;&gt;<i> people hate non-seamless.
</i>&gt;<i> 
</i>&gt;<i> Why not just resize the browser window by means of the internal window
</i>&gt;<i> manager or virtual display size?
</i>&gt;<i> (But why are you allowing JS then?)
</i>&gt;<i> 
</i>&gt;<i> Much easier than tossing HVM at it, you need to patch exactly one line
</i>&gt;<i> in the client VM.
</i>&gt;<i> Of course someone might have a weird screen size... but again, this
</i>&gt;<i> requires JS to be running.
</i>

Radoslaw,

Thanks for your extensive feedback! :)

However, we are talking at cross-purposes, I'm afraid.

You primarily seem to be talking about de-anonymization based on 
internet traffic data. Which is fine, but a level up from where I'm 
talking about here.

I'm talking about once an AnonVM has been compromised (not that hard in 
bloated OSes like Linux, etc), and the attacker can see most-or-all 
technical and user info contained within the AnonVM environment.

As various factors stand right now, based on 2 AnonVM compromises, or 
based on 1 AnonVM compromise correlated with other information 
databases, a person can be de-anonymized based on the CPU model info 
that Qubes/Xen is exposing to the AnonVM.

There are other characteristics of the AnonVM environment (especially 
non-hardware based) that make it uniquely fingerprintable in this way. I 
am personally working on programming a software solution to these types 
of &quot;other&quot; fingerprints in Qubes, this year in 2015.

But, as it stands, once compromised (with is pretty trivial to do), a 
Qubes AnonVM user could be de-anonymized in many scenarios based on 
their CPU info being exposed to the AnonVM.

It would just simply not be a problem/threat, if we just make the CPU 
look generic to the AnonVM, as some other virtualizers like VirtualBox 
go further with doing.

Sounds like the Xen HVM CPUID emulation module might be the fix for 
this.


WhonixQubes
</PRE>
<HR>
<P><UL>
<LI>Previous message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000310.html>[Whonix-devel] [qubes-devel] Re: Exposing AnonVM Users with Dom0 Hardware Fingerprint Leaks
</A></LI>
<LI>Next message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000312.html>[Whonix-devel] [qubes-devel] Re: Exposing AnonVM Users with Dom0 Hardware Fingerprint Leaks
</A></LI>
<LI> <B>Messages sorted by:</B>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/date.html#311">[ date ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/thread.html#311">[ thread ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/subject.html#311">[ subject ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/author.html#311">[ author ]</a>
</LI>
</UL>
<hr>
<a href="../../../../external.html?link=https://www.whonix.org/cgi-bin/mailman/listinfo/Whonix-devel">More information about the Whonix-devel
mailing list</a><br>
<script data-pagespeed-no-defer type="text/javascript">(function(){function f(b){var a=window;if(a.addEventListener)a.addEventListener("load",b,!1);else if(a.attachEvent)a.attachEvent("onload",b);else{var c=a.onload;a.onload=function(){b.call(this);c&&c.call(this)}}};window.pagespeed=window.pagespeed||{};var k=window.pagespeed;function l(b,a,c,g,h){this.h=b;this.i=a;this.l=c;this.j=g;this.b=h;this.c=[];this.a=0}l.prototype.f=function(b){for(var a=0;250>a&&this.a<this.b.length;++a,++this.a)try{document.querySelector(this.b[this.a])&&this.c.push(this.b[this.a])}catch(c){}this.a<this.b.length?window.setTimeout(this.f.bind(this),0,b):b()};
k.g=function(b,a,c,g,h){if(document.querySelector&&Function.prototype.bind){var d=new l(b,a,c,g,h);f(function(){window.setTimeout(function(){d.f(function(){for(var a="oh="+d.l+"&n="+d.j,a=a+"&cs=",b=0;b<d.c.length;++b){var c=0<b?",":"",c=c+encodeURIComponent(d.c[b]);if(131072<a.length+c.length)break;a+=c}k.criticalCssBeaconData=a;var b=d.h,c=d.i,e;if(window.XMLHttpRequest)e=new XMLHttpRequest;else if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(m){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){}}e&&
(e.open("../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/POST",b+(-1==b.indexOf("?")?"?":"&")+"url="+encodeURIComponent(c)),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(a))})},0)})}};k.criticalCssBeaconInit=k.g;})();
pagespeed.selectors=["pre"];pagespeed.criticalCssBeaconInit('/ngx_pagespeed_beacon','../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000311.html','y7aelHq7wr','sC6K0w8DREE',pagespeed.selectors);</script><script data-pagespeed-no-defer type="text/javascript">(function(){window.pagespeed=window.pagespeed||{};var f=window.pagespeed;function h(c,a,e,b){this.f=c;this.a=a;this.b=e;this.g=b}f.beaconUrl="";
function k(c){var a=c.f,e=window.mod_pagespeed_start,b=Number(new Date)-e,a=a+(-1==a.indexOf("?")?"?":"&"),a=a+"ets="+("load"==c.a?"load:":"unload:");if("beforeunload"!=c.a||!window.mod_pagespeed_loaded){a=a+b+("&r"+c.a+"=");if(window.performance){var b=window.performance.timing,d=b.navigationStart,g=b.requestStart,a=a+(b[c.a+"EventStart"]-d),a=a+("&nav="+(b.fetchStart-d)),a=a+("&dns="+(b.domainLookupEnd-b.domainLookupStart)),a=a+("&connect="+(b.connectEnd-b.connectStart)),a=a+("&req_start="+(g-d))+
("&ttfb="+(b.responseStart-g)),a=a+("&dwld="+(b.responseEnd-b.responseStart)),a=a+("&dom_c="+(b.domContentLoadedEventStart-d));window.performance.navigation&&(a+="&nt="+window.performance.navigation.type);d=-1;b.msFirstPaint?d=b.msFirstPaint:window.chrome&&window.chrome.loadTimes&&(d=Math.floor(1E3*window.chrome.loadTimes().firstPaintTime));d-=g;0<=d&&(a+="&fp="+d)}else a+=b;f.getResourceTimingData&&window.parent==window&&(a+=f.getResourceTimingData());a+=window.parent!=window?"&ifr=1":"&ifr=0";"load"==
c.a&&(window.mod_pagespeed_loaded=!0,(b=window.mod_pagespeed_num_resources_prefetched)&&(a+="&nrp="+b),(b=window.mod_pagespeed_prefetch_start)&&(a+="&htmlAt="+(e-b)));f.criticalCss&&(e=f.criticalCss,a+="&ccis="+e.total_critical_inlined_size+"&cces="+e.total_original_external_size+"&ccos="+e.total_overhead_size+"&ccrl="+e.num_replaced_links+"&ccul="+e.num_unreplaced_links);a+="&dpr="+window.devicePixelRatio;""!=c.b&&(a+=c.b);document.referrer&&(a+="&ref="+encodeURIComponent(document.referrer));a+=
"&url="+encodeURIComponent(c.g);f.beaconUrl=a;(new Image).src=a}}f.c=function(c,a,e,b){var d=new h(c,a,e,b);window.addEventListener?window.addEventListener(a,function(){k(d)},!1):window.attachEvent("on"+a,function(){k(d)})};f.addInstrumentationInit=f.c;})();

pagespeed.addInstrumentationInit('/ngx_pagespeed_beacon', 'load', '', '../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000311.html');</script></BODY>
<!-- Mirrored from www.whonix.org/pipermail/whonix-devel/2015-February/000311.html by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Wed, 29 Apr 2020 08:55:55 GMT -->
</HTML>
