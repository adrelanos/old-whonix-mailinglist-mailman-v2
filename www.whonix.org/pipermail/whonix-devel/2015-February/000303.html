<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>

<!-- Mirrored from www.whonix.org/pipermail/whonix-devel/2015-February/000303.html by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Wed, 29 Apr 2020 08:55:55 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=us-ascii" /><!-- /Added by HTTrack -->
<HEAD>
<TITLE> [Whonix-devel] Exposing AnonVM Users with Dom0 Hardware	Fingerprint Leaks
</TITLE>
<script>window.mod_pagespeed_start = Number(new Date());</script><LINK REL=Index HREF=index.html>
<LINK REL=made HREF="mailto:whonix-devel%40whonix.org?Subject=Re%3A%20%5BWhonix-devel%5D%20Exposing%20AnonVM%20Users%20with%20Dom0%20Hardware%0A%09Fingerprint%20Leaks&In-Reply-To=%3C54E1BAA9.4010701%40invisiblethingslab.com%3E">
<META NAME=robots CONTENT="index,nofollow">
<style type="text/css">pre{white-space:pre-wrap}</style>
<META http-equiv=Content-Type content="text/html; charset=us-ascii">
<LINK REL=Previous HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000302.html>
<LINK REL=Next HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000304.html>
</HEAD>
<BODY BGCOLOR="#ffffff">
<H1>[Whonix-devel] Exposing AnonVM Users with Dom0 Hardware	Fingerprint Leaks</H1>
<B>Joanna Rutkowska</B>
<A HREF="mailto:whonix-devel%40whonix.org?Subject=Re%3A%20%5BWhonix-devel%5D%20Exposing%20AnonVM%20Users%20with%20Dom0%20Hardware%0A%09Fingerprint%20Leaks&In-Reply-To=%3C54E1BAA9.4010701%40invisiblethingslab.com%3E" TITLE="[Whonix-devel] Exposing AnonVM Users with Dom0 Hardware	Fingerprint Leaks">joanna at invisiblethingslab.com
</A><BR>
<I>Mon Feb 16 10:38:49 CET 2015</I>
<P><UL>
<LI>Previous message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000302.html>[Whonix-devel] Exposing AnonVM Users with Dom0 Hardware Fingerprint	Leaks
</A></LI>
<LI>Next message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000304.html>[Whonix-devel] Exposing AnonVM Users with Dom0 Hardware	Fingerprint Leaks
</A></LI>
<LI> <B>Messages sorted by:</B>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/date.html#303">[ date ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/thread.html#303">[ thread ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/subject.html#303">[ subject ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/author.html#303">[ author ]</a>
</LI>
</UL>
<HR>
<PRE>On 02/16/15 03:56, WhonixQubes wrote:
&gt;<i> On 2015-02-16 1:11 am, Hakisho Nukama wrote:
</i>&gt;&gt;<i> &lt;snip&gt;
</i>&gt;&gt;<i>
</i>&gt;&gt;<i> Optimally the underlying VM wouldn't expose hardware information at all.
</i>&gt;&gt;<i> Apart from a default sanitized set of 1 <A HREF="../../../../external.html?link=https://www.whonix.org/cgi-bin/mailman/listinfo/whonix-devel">CPU at X</A> Mhz and Y MB RAM,
</i>&gt;&gt;<i> disk and network controller and default input and output devices,
</i>&gt;&gt;<i> with guaranteed resources and restriction on maximum resource
</i>&gt;&gt;<i> utilization.
</i>&gt;&gt;<i>
</i>&gt;&gt;<i> So every workload running in an anonvm under these constrains should
</i>&gt;&gt;<i> behave exactly identical, whether it runs on laptop A, laptop B or
</i>&gt;&gt;<i> desktop C
</i>&gt;&gt;<i> and should not be influenced by other task running on the host machine
</i>&gt;&gt;<i> (and vice versa, running task on this appvm shouldn't influence host
</i>&gt;&gt;<i> machine).
</i>&gt;&gt;<i>
</i>&gt;&gt;<i> VirtualBox used with Whonix does hide the processor model and
</i>&gt;&gt;<i> capabilities,
</i>&gt;&gt;<i> but not frequency.
</i>&gt;&gt;<i> Is there a way in cloaking all these information with modifications to
</i>&gt;&gt;<i> a hypervisor?
</i>&gt;&gt;<i> Or is there a reliable way to mask these information with a customized
</i>&gt;&gt;<i> kernel?
</i>&gt;&gt;<i>
</i>&gt;&gt;<i> This could evaporate the need of an anonymously obtained extra piece of
</i>&gt;&gt;<i> hardware for low risk situations.
</i>&gt;&gt;<i>
</i>&gt;&gt;<i> &lt;snip&gt;
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> Very important!!
</i>&gt;<i> 
</i>&gt;<i> I was going to post on this CPU/hardware fingerprinting issue soon.
</i>&gt;<i> 
</i>&gt;<i> Currently, Qubes/Xen exposes the underlying host CPU information.
</i>&gt;<i> 
</i>&gt;<i> Just try running this in any ordinary VM...
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> cat /proc/cpuinfo
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> And so *ANYTHING* that has access or gets access to your VMs will know
</i>&gt;<i> your unique machine's CPU info.
</i>&gt;<i> 
</i>&gt;<i> Qubes is based on the concept that the bloated monolithic OSes (Linux,
</i>&gt;<i> Windows, etc) that the individual VMs run on are relatively easy to
</i>&gt;<i> exploit and penetrate into. So, for security, Qubes implements very
</i>&gt;<i> strong isolation between VMs to counter this threat.
</i>&gt;<i> 
</i>&gt;<i> However, when applied to the goal of privacy/anonymity, Qubes isolation
</i>&gt;<i> breaks down when such underlying host information is freely given and
</i>&gt;<i> exposed to VMs. And so even AnonVMs can be easily fingerprinted as very
</i>&gt;<i> likely belonging to the same human person (e.g. exact same CPU info
</i>&gt;<i> recorded between multiple compromised AnonVMs).
</i>&gt;<i> 
</i>&gt;<i> I'd be very interested in answers or solutions to Hakisho's question of...
</i>&gt;<i> 
</i>&gt;<i> &quot;Is there a way in cloaking all these information with modifications to
</i>&gt;<i> a hypervisor?&quot;
</i>&gt;<i> 
</i>&gt;<i> Can Qubes sanitize the CPU -- and other unique hardware -- information
</i>&gt;<i> passed down from the Xen hypervisor to VMs?
</i>&gt;<i> 
</i>&gt;<i> This would be very important for any platform supporting
</i>&gt;<i> privacy/anonymity, as even VirtualBox seems to go further with.
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> Fixed dedicated resource utilization in VMs would be the ultimate as
</i>&gt;<i> Hakisho suggests, but at least simply sanitizing unique hardware info
</i>&gt;<i> would be a basic first step.
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> I also wonder if anybody here knows of other unique host information or
</i>&gt;<i> hardware (beyond the CPU or internal VM IP) that gets exposed to
</i>&gt;<i> ordinary VMs, or documented methods for testing such things?
</i>&gt;<i> 
</i>&gt;<i> I'm going to be exploring this issue in greater depth this year for
</i>&gt;<i> Qubes + Whonix and am hungry for all the good info I can get.
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> But, the big blatant AnonVM fingerprinting issue I noticed so far, for
</i>&gt;<i> Qubes, was the leak of unique host CPU info to all ordinary VMs.
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> CC'd to whonix-devel
</i>&gt;<i> 
</i>&gt;<i> 
</i>&gt;<i> 
</i>
Xen has support for emulating CPUID for HVM guests -- take a look at the
config examples in:

xen-4.1.6.1/tools/examples/xmexample.hvm-stubdom

I haven't played with it, but see no reasons it should not work. I can
imagine we introduce a prefs for VMs (say &quot;generic_cpuid&quot; settable via
qvm-prefs) that would be resulting in additional config for cpuid
emulation inserted in the config file for such VMs. We would need to
agree on good-enough-for-everybody CPUID config and stick to it then.
Again, this would be use-able for anon VMs mostly.

However, this will not work for PV VMs, because the CPUID instruction is
not a privileged instruction, so malware in a PV VM can always execute
this instruction (even if we hooked Xen interface for CPUID-like info to
the guest) without trapping into XEN in PV operation.

AFAIU, there are not personal identifying info returned by CPUID, but I
can see how this could be used as an additional fingerprinting vector.
Thus, perhaps we should consider distributing Whonix workstation
template as an HVM template instead of a PVM one? Fortunately we do have
templates support for HVMs, so this should be perfectly possible.

Let me also point out the already discussed-multiple-times topic of
potential covert channels between cooperative VMs, which might also be
potentially exploited in some scenarios to fingerprint user environment.
That is more difficult to address on PC architecture though, but some
work on Xen-level is nevertheless very welcome (see #817).

Thanks,
joanna.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: signature.asc
Type: application/pgp-signature
Size: 801 bytes
Desc: OpenPGP digital signature
URL: &lt;<A HREF="../../../../external.html?link=http://www.whonix.org/pipermail/whonix-devel/attachments/20150216/7fe09517/attachment.sig">http://www.whonix.org/pipermail/whonix-devel/attachments/20150216/7fe09517/attachment.sig</A>&gt;
</PRE>
<HR>
<P><UL>
<LI>Previous message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000302.html>[Whonix-devel] Exposing AnonVM Users with Dom0 Hardware Fingerprint	Leaks
</A></LI>
<LI>Next message: <A HREF=../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000304.html>[Whonix-devel] Exposing AnonVM Users with Dom0 Hardware	Fingerprint Leaks
</A></LI>
<LI> <B>Messages sorted by:</B>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/date.html#303">[ date ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/thread.html#303">[ thread ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/subject.html#303">[ subject ]</a>
<a href="../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/author.html#303">[ author ]</a>
</LI>
</UL>
<hr>
<a href="../../../../external.html?link=https://www.whonix.org/cgi-bin/mailman/listinfo/Whonix-devel">More information about the Whonix-devel
mailing list</a><br>
<script data-pagespeed-no-defer type="text/javascript">(function(){window.pagespeed=window.pagespeed||{};var f=window.pagespeed;function h(c,a,e,b){this.f=c;this.a=a;this.b=e;this.g=b}f.beaconUrl="";
function k(c){var a=c.f,e=window.mod_pagespeed_start,b=Number(new Date)-e,a=a+(-1==a.indexOf("?")?"?":"&"),a=a+"ets="+("load"==c.a?"load:":"unload:");if("beforeunload"!=c.a||!window.mod_pagespeed_loaded){a=a+b+("&r"+c.a+"=");if(window.performance){var b=window.performance.timing,d=b.navigationStart,g=b.requestStart,a=a+(b[c.a+"EventStart"]-d),a=a+("&nav="+(b.fetchStart-d)),a=a+("&dns="+(b.domainLookupEnd-b.domainLookupStart)),a=a+("&connect="+(b.connectEnd-b.connectStart)),a=a+("&req_start="+(g-d))+
("&ttfb="+(b.responseStart-g)),a=a+("&dwld="+(b.responseEnd-b.responseStart)),a=a+("&dom_c="+(b.domContentLoadedEventStart-d));window.performance.navigation&&(a+="&nt="+window.performance.navigation.type);d=-1;b.msFirstPaint?d=b.msFirstPaint:window.chrome&&window.chrome.loadTimes&&(d=Math.floor(1E3*window.chrome.loadTimes().firstPaintTime));d-=g;0<=d&&(a+="&fp="+d)}else a+=b;f.getResourceTimingData&&window.parent==window&&(a+=f.getResourceTimingData());a+=window.parent!=window?"&ifr=1":"&ifr=0";"load"==
c.a&&(window.mod_pagespeed_loaded=!0,(b=window.mod_pagespeed_num_resources_prefetched)&&(a+="&nrp="+b),(b=window.mod_pagespeed_prefetch_start)&&(a+="&htmlAt="+(e-b)));f.criticalCss&&(e=f.criticalCss,a+="&ccis="+e.total_critical_inlined_size+"&cces="+e.total_original_external_size+"&ccos="+e.total_overhead_size+"&ccrl="+e.num_replaced_links+"&ccul="+e.num_unreplaced_links);a+="&dpr="+window.devicePixelRatio;""!=c.b&&(a+=c.b);document.referrer&&(a+="&ref="+encodeURIComponent(document.referrer));a+=
"&url="+encodeURIComponent(c.g);f.beaconUrl=a;(new Image).src=a}}f.c=function(c,a,e,b){var d=new h(c,a,e,b);window.addEventListener?window.addEventListener(a,function(){k(d)},!1):window.attachEvent("on"+a,function(){k(d)})};f.addInstrumentationInit=f.c;})();

pagespeed.addInstrumentationInit('/ngx_pagespeed_beacon', 'load', '', '../../../../external.html?link=https://www.whonix.org/pipermail/whonix-devel/2015-February/000303.html');</script></BODY>
<!-- Mirrored from www.whonix.org/pipermail/whonix-devel/2015-February/000303.html by HTTraQt Website Copier/1.x [Karbofos 2012-2017] Wed, 29 Apr 2020 08:55:55 GMT -->
</HTML>
